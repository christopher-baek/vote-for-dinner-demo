<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Vote For Dinner</title>
    <script src="https://www.gstatic.com/firebasejs/3.6.5/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyA-t1V4oyJFu4q4A3L38EwGvIfw627V7Ek",
        authDomain: "vote-for-dinner-demo.firebaseapp.com",
        databaseURL: "https://vote-for-dinner-demo.firebaseio.com",
        storageBucket: "vote-for-dinner-demo.appspot.com",
        messagingSenderId: "243623928663"
      };
      firebase.initializeApp(config);
    </script>
  </head>
  <body>
    <input id="newUserFullName" type="text">
    <button id="registerNewUser">Register</button>
    <ul id="userList">
    </ul>
    <script>
      document.getElementById('registerNewUser').addEventListener('click', function() {
        var fullName = document.getElementById('newUserFullName').value;
        var userRef = firebase.database().ref('users').push();
        userRef.set({
          fullName: fullName
        });
        document.getElementById('newUserFullName').value = '';
      });
    </script>
    <script>
      var usersRef = firebase.database().ref('users');

      usersRef.on('child_added', function(data) {
        var userId = data.key;
        var userData = data.val();
        var fullName = userData['fullName'];

        var userListItem = document.createElement('li');
        userListItem.id = 'user-' + userId;
        userListItem.innerText = fullName + '(' + userId + ')';
        userListItem.addEventListener('click', function(event) {

          firebase.database().ref('users/' + userId).remove();
        });
        document.getElementById('userList').appendChild(userListItem);
      });
      /*
      usersRef.on('child_changed', function(data) {
        
      });
      */
      usersRef.on('child_removed', function(data) {
        var userId = data.key;
        document.getElementById('user-' + userId).remove();
      });
    </script>
  </body>
</html>
