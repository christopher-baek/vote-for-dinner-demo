<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Vote For Dinner</title>
    <script src="https://www.gstatic.com/firebasejs/3.6.5/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyA-t1V4oyJFu4q4A3L38EwGvIfw627V7Ek",
        authDomain: "vote-for-dinner-demo.firebaseapp.com",
        databaseURL: "https://vote-for-dinner-demo.firebaseio.com",
        storageBucket: "vote-for-dinner-demo.appspot.com",
        messagingSenderId: "243623928663"
      };
      firebase.initializeApp(config);
    </script>
  </head>
  <body>
    <div>
      <input id="newUserFullName" type="text">
      <button id="registerNewUser">Register</button>
    </div>
    <div>
      <input id="newDinnerOption" type="text">
      <button id="addNewDinnerOption">Add</button>
    </div>
    <ul id="userList">
    </ul>
    <ul id="dinnerList">
    </ul>
    <script>
      document.getElementById('registerNewUser').addEventListener('click', function() {
        var fullName = document.getElementById('newUserFullName').value;
        var userRef = firebase.database().ref('users').push();
        userRef.set({
          fullName: fullName
        });
        document.getElementById('newUserFullName').value = '';
      });
    </script>
    <script>
      var usersRef = firebase.database().ref('users');

      usersRef.on('child_added', function(data) {
        var userId = data.key;
        var userData = data.val();
        var fullName = userData['fullName'];

        var userListItem = document.createElement('li');
        userListItem.id = 'user-' + userId;
        userListItem.innerText = fullName + '(' + userId + ')';
        userListItem.addEventListener('click', function(event) {
          firebase.database().ref('users/' + userId).remove();
        });
        document.getElementById('userList').appendChild(userListItem);
      });
      /*
      usersRef.on('child_changed', function(data) {
        
      });
      */
      usersRef.on('child_removed', function(data) {
        var userId = data.key;
        document.getElementById('user-' + userId).remove();
      });
    </script>
    <script>
      document.getElementById('addNewDinnerOption').addEventListener('click', function() {
        var dinnerOption = document.getElementById('newDinnerOption').value;
        var dinnerRef = firebase.database().ref('dinner').push();
        dinnerRef.set({
          name: dinnerOption
        });
        document.getElementById('newDinnerOption').value = '';
      });
    </script>
    <script>
      var dinnerRef = firebase.database().ref('dinner');

      dinnerRef.on('child_added', function(data) {
        var dinnerId = data.key;
        var dinnerData = data.val();
        var name = dinnerData['name'];

        var dinnerListItem = document.createElement('li');
        dinnerListItem.id = 'dinner-' + dinnerId;
        dinnerListItem.innerText = name + '(' + dinnerId + ')';
        dinnerListItem.addEventListener('click', function(event) {
          firebase.database().ref('dinner/' + dinnerId).remove();
        });
        document.getElementById('dinnerList').appendChild(dinnerListItem);
      });
      dinnerRef.on('child_removed', function(data) {
        var dinnerId = data.key;
        document.getElementById('dinner-' + dinnerId).remove();
      });
    </script>
  </body>
</html>
